<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/documentation/blog/rss.xml" title="Cloud Adoption Framework for Terraform Landing zones RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/documentation/blog/atom.xml" title="Cloud Adoption Framework for Terraform Landing zones Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-GCM5PJNDCN","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GCM5PJNDCN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-GCM5PJNDCN",{anonymize_ip:!0})</script><title data-react-helmet="true">Levels Hierarchy | Cloud Adoption Framework for Terraform Landing zones</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://aztfmod.github.io/documentation/docs/fundamentals/lz-intro"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" name="robots" content="noindex"><meta data-react-helmet="true" property="og:title" content="Levels Hierarchy | Cloud Adoption Framework for Terraform Landing zones"><meta data-react-helmet="true" name="description" content="To address enterprise complexity, we recommend isolating and decomposing a complex environment in multiple state files."><meta data-react-helmet="true" property="og:description" content="To address enterprise complexity, we recommend isolating and decomposing a complex environment in multiple state files."><link data-react-helmet="true" rel="icon" href="/documentation/img/landingzones.ico"><link data-react-helmet="true" rel="canonical" href="https://aztfmod.github.io/documentation/docs/fundamentals/lz-intro"><link data-react-helmet="true" rel="alternate" href="https://aztfmod.github.io/documentation/docs/fundamentals/lz-intro" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://aztfmod.github.io/documentation/docs/fundamentals/lz-intro" hreflang="x-default"><link rel="stylesheet" href="/documentation/assets/css/styles.e2e0215a.css">
<link rel="preload" href="/documentation/assets/js/runtime~main.63325a91.js" as="script">
<link rel="preload" href="/documentation/assets/js/main.60d61445.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/documentation/"><div class="navbar__logo"><img src="/documentation/img/logo_landingzone.png" alt="Cloud Adoption Framework for Terraform Landing zones." class="themedImage_W2Cr themedImage--light_TfLj"><img src="/documentation/img/logo_landingzone.png" alt="Cloud Adoption Framework for Terraform Landing zones." class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Cloud Adoption Framework</b></a><a class="navbar__item navbar__link navbar__link--active" href="/documentation/docs/intro">Introduction</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/documentation/docs/fundamentals/lz-intro">Fundamentals</a><a class="navbar__item navbar__link navbar__link--active" href="/documentation/docs/module/module-intro">Module</a><a class="navbar__item navbar__link navbar__link--active" href="/documentation/docs/rover/rover-intro">Rover</a><a class="navbar__item navbar__link navbar__link--active" href="/documentation/docs/provider/provider-intro">Provider</a><a class="navbar__item navbar__link navbar__link--active" href="/documentation/docs/enterprise-scale/landingzones/eslz-intro">Enterprise-scale</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/aztfmod/documentation" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation/docs/intro">Welcome to Cloud Adoption Framework Landing zones for Terraform</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/documentation/docs/fundamentals/lz-intro">fundamentals</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/documentation/docs/fundamentals/lz-intro">Levels Hierarchy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/docs/fundamentals/lz-compute">Compute Nodes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/docs/fundamentals/lz-composition">Cross-levels composition</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/docs/fundamentals/lz-launchpad">What is launchpad</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/documentation/docs/module/module-intro">module</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/documentation/docs/provider/provider-intro">provider</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/documentation/docs/rover/rover-intro">rover</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/documentation/docs/enterprise-scale/landingzones/eslz-intro">enterprise-scale</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Levels Hierarchy</h1><p>To address enterprise complexity, we recommend isolating and decomposing a complex environment in multiple state files.</p><p>The main concern with state files is related to security, as a Terraform state file might contain credentials, security tokens, keys etc. It is reasonable that state files corresponding to different levels of privileges are stored separately.</p><p>Another concern with state file, which calls for segregation, is the speed of innovation: When someone is conducting a change for a resource in a given state file, no-one else can change the state file at the same time, so having a limited number of state files can hinder the testing or integration processes in the enterprise.</p><p>Finally since DevOps is building in teams, we want to unlock autonomy of teams yet delegating some functions (application teams will not re-invent the networking layers but build on it). It will mean the capability to read a state file to do rich composition but without the possibility to alter the state file from other teams.</p><p>In CAF Terraform landing zones, separating the Terraform state files enables you to:</p><ul><li><strong>Control blast radius</strong>: if one configuration is deficient, it only impacts one landing zone and does not compromise the whole environment.</li><li><strong>Enforce standard configuration</strong>: by using different Terraform state, you can compose a complex environment very fast.</li><li><strong>Enable autonomy</strong>: different landing zones can enable innovation and features at different pace from each other.</li><li><strong>Least privilege principles</strong>: Each level is protected by its own identity to prevent unwanted information disclosure and modifications.</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="the-levels-approach">The levels approach<a class="hash-link" href="#the-levels-approach" title="Direct link to heading">â€‹</a></h2><p>We categorize and store state files into <em>levels</em>.</p><p>A level groups together a set of state files that needs separation because of different <strong>lifecycles</strong> or <strong>privileges</strong>.</p><p>The model can be summarized as below:</p><p><img alt="Model for levels for CAF Terraform landing zones" src="/documentation/assets/images/terraform-model-levels-eb5316af5b6561974d8373aa18d955b6.png" width="1199" height="591">
<em>Figure 1: An overview of the levels proposed by CAF Terraform landing zones to structure Terraform states</em></p><p>The core principles are:</p><ul><li><strong>One level can host multiple state files</strong>: A level is implemented as an Azure storage account with specific permissions, you can store as many Terraform state files as necessary on a particular level.</li><li><strong>Rover helps you locate the right storage account</strong>: Whether you are running CAF landing zones locally or in pipeline, rover helps you locate the right storage account for a given environment and level. Authorization to deploy at a level is granted by Azure RBAC model and enforced at runtime (with the current logged in user credentials, or via the pipeline credentials).</li><li><strong>You can only write in your current level</strong>: at a given level, you can only write the Terraform state file that you are responsible for.</li><li><strong>Read one level down</strong>: at any particular level, you are able to read information one level down for your composition (one AKS cluster at level 3 can read the Terraform state file at level 2 to compose).</li><li><strong>Codeless state reading and enterprise composition</strong>: CAF Terraform landing zones come with an object model that allow to load any landing zone (given principal accessing it has access ) in memory and compose from it.</li></ul><p>Cloud Adoption Framework for Azure proposes a hierarchy of landing zones based on five levels as described below:</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="level-0-core-platform-automation">Level 0: Core platform automation<a class="hash-link" href="#level-0-core-platform-automation" title="Direct link to heading">â€‹</a></h3><p>The different landing zones represented in different state files at level 0 would typically be:</p><ul><li>The <strong>launchpad</strong> (storage accounts, Key Vault, RBAC, etc.) components related to Terraform state management.</li><li>The <strong>subscription creation delegation</strong> capabilities derived from the <a href="https://docs.microsoft.com/azure/cost-management-billing/manage/ea-portal-get-started" target="_blank" rel="noopener noreferrer">Enterprise Agreement</a> or <a href="https://docs.microsoft.com/azure/cost-management-billing/understand/mca-overview" target="_blank" rel="noopener noreferrer">Microsoft Customer Agreement</a>.</li><li>The credential rotation mechanisms and role-based access control core models.</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="level-1-core-platform-governance">Level 1: Core platform governance<a class="hash-link" href="#level-1-core-platform-governance" title="Direct link to heading">â€‹</a></h3><p>The different landing zones represented in different state files at level 1 would typically be:</p><ul><li>The <strong>enterprise-scale</strong> (management groups, policies) this would include the core enterprise-scale capabilities with the related custom management group structures and policies configuration. You can either use the out-of-the-box settings for enterprise-scale or customize the values for your organization.</li><li>The <strong>GitOps services</strong> for core platform automation: creating the pipelines, creating the Virtual Network and compute nodes (see below) required for the DevOps self-hosted agents.</li><li>The <strong>platform subscription creation</strong> for core platform (to create the core enterprise-scale subscriptions like Identify, Management, Connectivity etc.)</li><li>The <strong>management subscription services</strong> for core platform capabilities such as log management, Azure Monitor capabilities, etc.</li><li>The <strong>identity subscription services</strong> for core platform such as domain controller virtual machines, Azure Active Directory Domain Services, Azure AD Group mappings etc.</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="level-2-core-platform-connectivity">Level 2: Core platform connectivity<a class="hash-link" href="#level-2-core-platform-connectivity" title="Direct link to heading">â€‹</a></h3><p>The different landing zones represented in different state files at level 2 would typically be:</p><ul><li>The <strong>connectivity subscription components</strong>: including the virtual networking components like classic Virtual Network-based Hub and Spoke, Azure Virtual WAN, Azure Virtual WAN regional hub, site-to-site, point-to-site and ExpressRoute connectivity objects, or third parties Network Virtual Appliances. Due to their regional nature, it is likely that each of those components would live inside a different Terraform state file.</li><li>Additional <strong>identity subscription services</strong>: could be Azure Active Directory Domain Services (managed AD), or Virtual-machine-based domain controllers.</li><li>Additional <strong>management subscription services</strong>: could be System Center Configuration Manager, Shared Imaged Galleries, Monitor Alerts or third parties management tools.</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="level-3-application-landing-zones-vending-machine">Level 3: Application landing zones vending machine<a class="hash-link" href="#level-3-application-landing-zones-vending-machine" title="Direct link to heading">â€‹</a></h3><p>A landing zone for application is split between two levels. Level 3 includes components of an application that are typically delegated to platform operations teams.</p><p>Capabilities in level 3 would be:</p><ul><li>The <strong>application subscriptions creation</strong>: capability to create subscriptions for various environments: Development, Test, UAT, DR, etc.</li><li>The <strong>privileged infrastructure services</strong>: to support the application platform. This would usually include components like virtual network blocks, virtual network peering objects to hubs, route tables and delegated identities (to deploy level4 services and whenever applicable applications deployment credentials).</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="level-4-applications-landing-zone">Level 4: Applications landing zone<a class="hash-link" href="#level-4-applications-landing-zone" title="Direct link to heading">â€‹</a></h3><p>This level contains the application configuration <strong>delegated for application teams</strong>.</p><p>It contains for example Azure Kubernetes Services Cluster, API Management services and all its dependency to deliver a service. This can be sourced from Azure landing zones solution accelerators, a custom solutions implemented using CAF module or any other Terraform code.</p><p>The following pictures illustrates the split between level 3 and 4:
<img alt="Data and AI landing zones accross level 3 and 4" src="/documentation/assets/images/terraform-model-levels3-4-f637807b6e806a0c83b76d8ae87b966c.png" width="3000" height="1743">
<em>Figure 2: Example of Data and AI landing zone for level 3 and 4</em></p><p>The broader picture on the complete environment would look like that:</p><p><img alt="Subscription Vending Machine Example" src="/documentation/assets/images/terraform-model-levels-svm-fcb46194d9869c785d46290b47da40d6.png" width="3022" height="1476">
<em>Figure 3: Subscription Vending Machine Example</em></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="operating-with-levels">Operating with levels<a class="hash-link" href="#operating-with-levels" title="Direct link to heading">â€‹</a></h3><p>A deployment will typically contain:</p><ul><li>A couple of level 0 landing zones.</li><li>Few level 1 and 2 landing zones.</li><li>Many level 3 landing zones.</li><li>Many level 4 applications will exist in an environment.</li></ul><p>For a given level in the environment, each compute node (see below) will be assigned an identity (see below) that will be used to authenticate and authorize operations on:</p><ul><li>The target Azure Subscription</li><li>The Terraform state file: will be Read and Write permissions for the current level, will be Read only permissions for a &quot;lower&quot; level type of landing zone, avoiding alterations on more privileged environments.</li></ul><p>In the example above, each pipeline will have its lifecycle management:</p><ul><li>Level 0 and 1 will be called when updating the core platform.</li><li>Level 2 will be triggered when you are opening a new regional hub, or adding connectivity capabilities.</li><li>Level 3 will be triggered when you deploy a new service (Application Gateway, App Service Environment, Azure Kubernetes Services, etc.)</li><li>Level 4 can be initiated as many times a day as you deploy code in your application environment.</li></ul><p>An enterprise environment will consist of a series of pipelines enforcing the different types of environments in different subscriptions.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/aztfmod/documentation/tree/main/website/docs/fundamentals/intro.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/documentation/docs/intro"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Welcome to Cloud Adoption Framework Landing zones for Terraform</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/documentation/docs/fundamentals/lz-compute"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Compute Nodes</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-levels-approach" class="table-of-contents__link toc-highlight">The levels approach</a><ul><li><a href="#level-0-core-platform-automation" class="table-of-contents__link toc-highlight">Level 0: Core platform automation</a></li><li><a href="#level-1-core-platform-governance" class="table-of-contents__link toc-highlight">Level 1: Core platform governance</a></li><li><a href="#level-2-core-platform-connectivity" class="table-of-contents__link toc-highlight">Level 2: Core platform connectivity</a></li><li><a href="#level-3-application-landing-zones-vending-machine" class="table-of-contents__link toc-highlight">Level 3: Application landing zones vending machine</a></li><li><a href="#level-4-applications-landing-zone" class="table-of-contents__link toc-highlight">Level 4: Applications landing zone</a></li><li><a href="#operating-with-levels" class="table-of-contents__link toc-highlight">Operating with levels</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/documentation/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://aka.ms/arnaud" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Arnauds blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://gitter.im/aztfmod/community" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Gitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/azure/caf-terraform-landingzones" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Cloud Adoption Framework for Terraform Landing zones.</div></div></div></footer></div>
<script src="/documentation/assets/js/runtime~main.63325a91.js"></script>
<script src="/documentation/assets/js/main.60d61445.js"></script>
</body>
</html>